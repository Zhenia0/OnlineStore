function cov_138ib6wopm(){var path="C:\\Users\\Lenovo\\Desktop\\CourseWork\\server\\controllers\\userController.js";var hash="fc58d33cce913444b531dfaa1a524ae854ab4fe3";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Lenovo\\Desktop\\CourseWork\\server\\controllers\\userController.js",statementMap:{"0":{start:{line:1,column:17},end:{line:1,column:45}},"1":{start:{line:2,column:15},end:{line:2,column:32}},"2":{start:{line:3,column:12},end:{line:3,column:35}},"3":{start:{line:4,column:23},end:{line:4,column:36}},"4":{start:{line:6,column:20},end:{line:12,column:1}},"5":{start:{line:7,column:4},end:{line:11,column:5}},"6":{start:{line:16,column:40},end:{line:16,column:48}},"7":{start:{line:17,column:8},end:{line:19,column:9}},"8":{start:{line:18,column:12},end:{line:18,column:79}},"9":{start:{line:20,column:26},end:{line:20,column:62}},"10":{start:{line:21,column:8},end:{line:23,column:9}},"11":{start:{line:22,column:12},end:{line:22,column:89}},"12":{start:{line:24,column:29},end:{line:24,column:59}},"13":{start:{line:25,column:21},end:{line:25,column:77}},"14":{start:{line:26,column:23},end:{line:26,column:61}},"15":{start:{line:27,column:22},end:{line:27,column:65}},"16":{start:{line:28,column:8},end:{line:28,column:32}},"17":{start:{line:32,column:34},end:{line:32,column:42}},"18":{start:{line:33,column:21},end:{line:33,column:57}},"19":{start:{line:34,column:8},end:{line:36,column:9}},"20":{start:{line:35,column:12},end:{line:35,column:68}},"21":{start:{line:37,column:30},end:{line:37,column:73}},"22":{start:{line:38,column:8},end:{line:40,column:9}},"23":{start:{line:39,column:12},end:{line:39,column:68}},"24":{start:{line:41,column:22},end:{line:41,column:65}},"25":{start:{line:42,column:8},end:{line:42,column:32}},"26":{start:{line:46,column:22},end:{line:46,column:77}},"27":{start:{line:47,column:8},end:{line:47,column:32}},"28":{start:{line:51,column:0},end:{line:51,column:37}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:20},end:{line:6,column:21}},loc:{start:{line:6,column:40},end:{line:12,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:4},end:{line:15,column:5}},loc:{start:{line:15,column:38},end:{line:29,column:5}},line:15},"2":{name:"(anonymous_2)",decl:{start:{line:31,column:4},end:{line:31,column:5}},loc:{start:{line:31,column:31},end:{line:43,column:5}},line:31},"3":{name:"(anonymous_3)",decl:{start:{line:45,column:4},end:{line:45,column:5}},loc:{start:{line:45,column:31},end:{line:48,column:5}},line:45}},branchMap:{"0":{loc:{start:{line:17,column:8},end:{line:19,column:9}},type:"if",locations:[{start:{line:17,column:8},end:{line:19,column:9}},{start:{line:17,column:8},end:{line:19,column:9}}],line:17},"1":{loc:{start:{line:17,column:11},end:{line:17,column:30}},type:"binary-expr",locations:[{start:{line:17,column:11},end:{line:17,column:17}},{start:{line:17,column:21},end:{line:17,column:30}}],line:17},"2":{loc:{start:{line:21,column:8},end:{line:23,column:9}},type:"if",locations:[{start:{line:21,column:8},end:{line:23,column:9}},{start:{line:21,column:8},end:{line:23,column:9}}],line:21},"3":{loc:{start:{line:34,column:8},end:{line:36,column:9}},type:"if",locations:[{start:{line:34,column:8},end:{line:36,column:9}},{start:{line:34,column:8},end:{line:36,column:9}}],line:34},"4":{loc:{start:{line:38,column:8},end:{line:40,column:9}},type:"if",locations:[{start:{line:38,column:8},end:{line:40,column:9}},{start:{line:38,column:8},end:{line:40,column:9}}],line:38}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"fc58d33cce913444b531dfaa1a524ae854ab4fe3"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_138ib6wopm=function(){return actualCoverage;};}return actualCoverage;}cov_138ib6wopm();const ApiError=(cov_138ib6wopm().s[0]++,require('../error/ApiError'));const bcrypt=(cov_138ib6wopm().s[1]++,require('bcrypt'));const jwt=(cov_138ib6wopm().s[2]++,require('jsonwebtoken'));const{User,Basket}=(cov_138ib6wopm().s[3]++,global.models);cov_138ib6wopm().s[4]++;const generateJwt=(id,email,role)=>{cov_138ib6wopm().f[0]++;cov_138ib6wopm().s[5]++;return jwt.sign({id,email,role},process.env.SECRET_KEY,{expiresIn:'24h'});};class UserController{async registration(req,res,next){cov_138ib6wopm().f[1]++;const{email,password,role}=(cov_138ib6wopm().s[6]++,req.body);cov_138ib6wopm().s[7]++;if((cov_138ib6wopm().b[1][0]++,!email)||(cov_138ib6wopm().b[1][1]++,!password)){cov_138ib6wopm().b[0][0]++;cov_138ib6wopm().s[8]++;return next(ApiError.badRequest('Некорректный email или password'));}else{cov_138ib6wopm().b[0][1]++;}const candidate=(cov_138ib6wopm().s[9]++,await User.findOne({where:{email}}));cov_138ib6wopm().s[10]++;if(candidate){cov_138ib6wopm().b[2][0]++;cov_138ib6wopm().s[11]++;return next(ApiError.badRequest('Пользователь с таким email уже существует'));}else{cov_138ib6wopm().b[2][1]++;}const hashPassword=(cov_138ib6wopm().s[12]++,await bcrypt.hash(password,5));const user=(cov_138ib6wopm().s[13]++,await User.create({email,role,password:hashPassword}));const basket=(cov_138ib6wopm().s[14]++,await Basket.create({userId:user.id}));const token=(cov_138ib6wopm().s[15]++,generateJwt(user.id,user.email,user.role));cov_138ib6wopm().s[16]++;return res.json({token});}async login(req,res,next){cov_138ib6wopm().f[2]++;const{email,password}=(cov_138ib6wopm().s[17]++,req.body);const user=(cov_138ib6wopm().s[18]++,await User.findOne({where:{email}}));cov_138ib6wopm().s[19]++;if(!user){cov_138ib6wopm().b[3][0]++;cov_138ib6wopm().s[20]++;return next(ApiError.internal('Пользователь не найден'));}else{cov_138ib6wopm().b[3][1]++;}let comparePassword=(cov_138ib6wopm().s[21]++,bcrypt.compareSync(password,user.password));cov_138ib6wopm().s[22]++;if(!comparePassword){cov_138ib6wopm().b[4][0]++;cov_138ib6wopm().s[23]++;return next(ApiError.internal('Указан неверный пароль'));}else{cov_138ib6wopm().b[4][1]++;}const token=(cov_138ib6wopm().s[24]++,generateJwt(user.id,user.email,user.role));cov_138ib6wopm().s[25]++;return res.json({token});}async check(req,res,next){cov_138ib6wopm().f[3]++;const token=(cov_138ib6wopm().s[26]++,generateJwt(req.user.id,req.user.email,req.user.role));cov_138ib6wopm().s[27]++;return res.json({token});}}cov_138ib6wopm().s[28]++;module.exports=new UserController();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXJDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbIkFwaUVycm9yIiwicmVxdWlyZSIsImJjcnlwdCIsImp3dCIsIlVzZXIiLCJCYXNrZXQiLCJnbG9iYWwiLCJtb2RlbHMiLCJnZW5lcmF0ZUp3dCIsImlkIiwiZW1haWwiLCJyb2xlIiwic2lnbiIsInByb2Nlc3MiLCJlbnYiLCJTRUNSRVRfS0VZIiwiZXhwaXJlc0luIiwiVXNlckNvbnRyb2xsZXIiLCJyZWdpc3RyYXRpb24iLCJyZXEiLCJyZXMiLCJuZXh0IiwicGFzc3dvcmQiLCJib2R5IiwiYmFkUmVxdWVzdCIsImNhbmRpZGF0ZSIsImZpbmRPbmUiLCJ3aGVyZSIsImhhc2hQYXNzd29yZCIsImhhc2giLCJ1c2VyIiwiY3JlYXRlIiwiYmFza2V0IiwidXNlcklkIiwidG9rZW4iLCJqc29uIiwibG9naW4iLCJpbnRlcm5hbCIsImNvbXBhcmVQYXNzd29yZCIsImNvbXBhcmVTeW5jIiwiY2hlY2siLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiMCtIQWVZOzJGQWZaLEtBQU1BLENBQUFBLFFBQVEsMEJBQUdDLE9BQU8sQ0FBQyxtQkFBRCxDQUFWLENBQWQsQ0FDQSxLQUFNQyxDQUFBQSxNQUFNLDBCQUFHRCxPQUFPLENBQUMsUUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNRSxDQUFBQSxHQUFHLDBCQUFHRixPQUFPLENBQUMsY0FBRCxDQUFWLENBQVQsQ0FDQSxLQUFNLENBQUNHLElBQUQsQ0FBT0MsTUFBUCwyQkFBaUJDLE1BQU0sQ0FBQ0MsTUFBeEIsQ0FBTixDLHdCQUVBLEtBQU1DLENBQUFBLFdBQVcsQ0FBRyxDQUFDQyxFQUFELENBQUtDLEtBQUwsQ0FBWUMsSUFBWixHQUFvQixpREFDcEMsTUFBT1IsQ0FBQUEsR0FBRyxDQUFDUyxJQUFKLENBQ0gsQ0FBQ0gsRUFBRCxDQUFLQyxLQUFMLENBQVlDLElBQVosQ0FERyxDQUVIRSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFGVCxDQUdILENB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Q2UsSUFBSixDQUFTLENBQUNELEtBQUQsQ0FBVCxDQUFQLENBQ0gsQ0FFVSxLQUFMTSxDQUFBQSxLQUFLLENBQUNyQixHQUFELENBQU1DLEdBQU4sQ0FBV0MsSUFBWCxDQUFnQix5QkFDdkIsS0FBTWEsQ0FBQUEsS0FBSywyQkFBRzFCLFdBQVcsQ0FBQ1csR0FBRyxDQUFDVyxJQUFKLENBQVNyQixFQUFWLENBQWNVLEdBQUcsQ0FBQ1csSUFBSixDQUFTcEIsS0FBdkIsQ0FBOEJTLEdBQUcsQ0FBQ1csSUFBSixDQUFTbkIsSUFBdkMsQ0FBZCxDQUFYLENBRHVCLHlCQUV2QixNQUFPUyxDQUFBQSxHQUFHLENBQUNlLElBQUosQ0FBUyxDQUFDRCxLQUFELENBQVQsQ0FBUCxDQUNILENBbENlLEMseUJBcUNwQk8sTUFBTSxDQUFDQyxPQUFQLENBQWlCLEdBQUl6QixDQUFBQSxjQUFKLEVBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQXBpRXJyb3IgPSByZXF1aXJlKCcuLi9lcnJvci9BcGlFcnJvcicpO1xyXG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHQnKVxyXG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKVxyXG5jb25zdCB7VXNlciwgQmFza2V0fSA9IGdsb2JhbC5tb2RlbHM7XHJcblxyXG5jb25zdCBnZW5lcmF0ZUp3dCA9IChpZCwgZW1haWwsIHJvbGUpID0+e1xyXG4gICAgcmV0dXJuIGp3dC5zaWduKFxyXG4gICAgICAgIHtpZCwgZW1haWwsIHJvbGV9LFxyXG4gICAgICAgIHByb2Nlc3MuZW52LlNFQ1JFVF9LRVksXHJcbiAgICAgICAge2V4cGlyZXNJbjogJzI0aCd9XHJcbiAgICApXHJcbn1cclxuXHJcbmNsYXNzIFVzZXJDb250cm9sbGVye1xyXG4gICAgYXN5bmMgcmVnaXN0cmF0aW9uKHJlcSwgcmVzLCBuZXh0KXtcclxuICAgICAgICBjb25zdCB7ZW1haWwsIHBhc3N3b3JkLCByb2xlfSA9IHJlcS5ib2R5XHJcbiAgICAgICAgaWYoIWVtYWlsIHx8ICFwYXNzd29yZCl7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXh0KEFwaUVycm9yLmJhZFJlcXVlc3QoJ9Cd0LXQutC+0YDRgNC10LrRgtC90YvQuSBlbWFpbCDQuNC70LggcGFzc3dvcmQnKSlcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgY2FuZGlkYXRlID0gYXdhaXQgVXNlci5maW5kT25lKHt3aGVyZToge2VtYWlsfX0pXHJcbiAgICAgICAgaWYoY2FuZGlkYXRlKXtcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQoQXBpRXJyb3IuYmFkUmVxdWVzdCgn0J/QvtC70YzQt9C+0LLQsNGC0LXQu9GMINGBINGC0LDQutC40LwgZW1haWwg0YPQttC1INGB0YPRidC10YHRgtCy0YPQtdGCJykpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGhhc2hQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCA1KVxyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmNyZWF0ZSh7ZW1haWwsIHJvbGUsIHBhc3N3b3JkOiBoYXNoUGFzc3dvcmR9KVxyXG4gICAgICAgIGNvbnN0IGJhc2tldCA9IGF3YWl0IEJhc2tldC5jcmVhdGUoe3VzZXJJZDogdXNlci5pZH0pXHJcbiAgICAgICAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZUp3dCh1c2VyLmlkLCB1c2VyLmVtYWlsLCB1c2VyLnJvbGUpXHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHt0b2tlbn0pXHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgbG9naW4ocmVxLCByZXMsIG5leHQpe1xyXG4gICAgICAgIGNvbnN0IHtlbWFpbCwgcGFzc3dvcmR9ID0gcmVxLmJvZHlcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT25lKHt3aGVyZToge2VtYWlsfX0pXHJcbiAgICAgICAgaWYoIXVzZXIpe1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dChBcGlFcnJvci5pbnRlcm5hbCgn0J/QvtC70YzQt9C+0LLQsNGC0LXQu9GMINC90LUg0L3QsNC50LTQtdC9JykpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBjb21wYXJlUGFzc3dvcmQgPSBiY3J5cHQuY29tcGFyZVN5bmMocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpXHJcbiAgICAgICAgaWYoIWNvbXBhcmVQYXNzd29yZCl7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXh0KEFwaUVycm9yLmludGVybmFsKCfQo9C60LDQt9Cw0L0g0L3QtdCy0LXRgNC90YvQuSDQv9Cw0YDQvtC70YwnKSlcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZUp3dCh1c2VyLmlkLCB1c2VyLmVtYWlsLCB1c2VyLnJvbGUpXHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHt0b2tlbn0pXHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgY2hlY2socmVxLCByZXMsIG5leHQpe1xyXG4gICAgICAgIGNvbnN0IHRva2VuID0gZ2VuZXJhdGVKd3QocmVxLnVzZXIuaWQsIHJlcS51c2VyLmVtYWlsLCByZXEudXNlci5yb2xlKVxyXG4gICAgICAgIHJldHVybiByZXMuanNvbih7dG9rZW59KVxyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBVc2VyQ29udHJvbGxlcigpIl19